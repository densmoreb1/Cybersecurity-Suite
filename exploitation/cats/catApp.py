import PySimpleGUI as sg
import os
import PyInstaller.__main__
import shutil
from sys import platform

def run_pyinstaller(name):
    path = os.getcwd()
    full_path = os.path.join(path, "exploitation/cats/catPictures.py")

    if platform == "Windows":
        full_path = full_path.replace('/', '\\')

    PyInstaller.__main__.run([
        full_path,
        '--onefile',
        '--windowed',
        '--clean',
        f'-n{name}'
    ])

    os.remove(f"{values[0]}.spec")
    shutil.move(f"dist/{values[0]}", ".")
    shutil.move(f"dist/{values[0]}.app", ".", copy_function=shutil.copytree)
    shutil.rmtree("dist")
    shutil.rmtree("build")

sg.theme('Dark Grey 13')
sg.set_options(font='sans')

sg.popup("""
This program will create a file with whatever name you give it. \
The program is a runnable app or script. This will display cat \
pictures until the program is shutdown.
""", any_key_closes=True, )

sg.popup("""
The way this works is by calling an api and using the Pillow library to display them to the screen.
""", any_key_closes=True, )

layout = [
    [sg.Text('Enter a name you would like the file')],
    [sg.Input()],
    [sg.B('Okay', bind_return_key=True)]
]

window = sg.Window('Cat Pictures', layout)
while True:
    event, values = window.read()
    if event == sg.WIN_CLOSED or event == 'Exit':
        break
    elif event == 'Okay':
        run_pyinstaller(values[0])
        sg.popup("Done!", any_key_closes=True)
        window.close()
    elif event == 'Clear':
        window.find_element('out').Update('')

window.close()
